function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var t=e(require("short-uuid")),r=e(require("crypto-js")),n=new Date(+new Date+864e5).toISOString(),i=n.split("-").join("").split(":").join("").split(".").join(""),o=n.split("T")[0].split("-").join(""),s=function(){};s.getPolicy=function(e){return new Buffer(JSON.stringify({expiration:n,conditions:[{acl:"public-read"},{bucket:e.bucketName},["starts-with","$key",e.dirName?e.dirName+"/":""],["starts-with","$Content-Type",""],["starts-with","$x-amz-meta-tag",""],{"x-amz-algorithm":"AWS4-HMAC-SHA256"},{"x-amz-credential":e.accessKeyId+"/"+o+"/"+e.region+"/s3/aws4_request"},{"x-amz-date":i},{"x-amz-meta-uuid":"14365123651274"},{"x-amz-server-side-encryption":"AES256"}]})).toString("base64").replace(/\n|\r/,"")};var a=function(){};a.getSignature=function(e,t,n){var i,o,s,a,c,u;return r.HmacSHA256(n,(i=e.secretAccessKey,o=t,s=e.region,a=r.HmacSHA256(o,"AWS4"+i),c=r.HmacSHA256(s,a),u=r.HmacSHA256("s3",c),r.HmacSHA256("aws4_request",u))).toString(r.enc.Hex)};var c=function(e){this.config=e};c.prototype.uploadFile=function(e,r,n){try{var c=this;!function(e,t){if(null===e.bucketName||""===e.bucketName)throw new Error("Your bucketName cannot be empty ");if(null===e.region||""===e.region)throw new Error("Must provide a valide region in order to use your bucket");if(null===e.accessKeyId||""===e.accessKeyId)throw new Error("Must provide accessKeyId");if(null===e.secretAccessKey||""===e.secretAccessKey)throw new Error("Must provide secretAccessKey");if(!t)throw new Error("File cannot be empty")}(c.config,e);var u=new FormData,m=e.type.split("/")[1],p=(r||t.generate())+"."+m,d=(c.config.dirName?c.config.dirName+"/":"")+p,l=(f=c.config).s3Url&&""!==f.s3Url?f.s3Url:(h=(g=f).bucketName,"cn"===(w=(y=g.region).split("-")[0])?"https://"+h+".s3."+y+".amazonaws.com."+w:"us-east-1"===y?"https://"+h+".s3."+y+".amazonaws.com":"https://"+h+".s3-"+y+".amazonaws.com");return u.append("key",d),u.append("acl","public-read"),u.append("Content-Type",e.type),u.append("x-amz-meta-uuid","14365123651274"),u.append("x-amz-server-side-encryption","AES256"),u.append("X-Amz-Credential",c.config.accessKeyId+"/"+o+"/"+c.config.region+"/s3/aws4_request"),u.append("X-Amz-Algorithm","AWS4-HMAC-SHA256"),u.append("X-Amz-Date",i),u.append("x-amz-meta-tag",""),u.append("Policy",s.getPolicy(c.config)),u.append("X-Amz-Signature",a.getSignature(c.config,o,s.getPolicy(c.config))),u.append("file",e),Promise.resolve(function(e,t,r){return r?new Promise(function(n,i){var o=new XMLHttpRequest;for(var s in o.open(t.method||"get",e,!0),o.onreadystatechange=function(){4===this.readyState&&(200<=this.status&&299>=this.status?n({ok:!0,status:this.status,event:this}):i({ok:!1,status:this.status,event:this}))},t.headers||{})o.setRequestHeader(s,t.headers[s]);o.onload=function(){n(this.response)},o.onerror=function(e){return i},o.upload&&r&&(o.upload.onprogress=r),o.send(t.body)}):fetch(e,t)}(l,{method:"post",body:u},n)).then(function(e){return e.ok?Promise.resolve({bucket:c.config.bucketName,key:(c.config.dirName?c.config.dirName+"/":"")+p,location:l+"/"+(c.config.dirName?c.config.dirName+"/":"")+p,status:e.status}):Promise.reject(e)})}catch(e){return Promise.reject(e)}var f,g,h,y,w},c.prototype.deleteFile=function(e){try{return Promise.resolve(fetch("https://"+this.config.bucketName+".s3"+(this.config.region?"-"+this.config.region:"")+".amazonaws.com/"+(this.config.dirName?this.config.dirName+"/":"")+e,{method:"delete"})).then(function(t){return t.ok?Promise.resolve({ok:t.ok,status:t.status,message:"File Deleted",fileName:e}):Promise.reject(t)})}catch(e){return Promise.reject(e)}},module.exports=c;
//# sourceMappingURL=aws-s3.js.map
